(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t){var n;return function(e){return void 0!==e.id}(e)?n=e.id:t&&t.length&&(n=t[0].id),{id:n,firstName:e.firstName,lastName:e.lastName,company:e.company,addressLine1:e.address1,addressLine2:e.address2,city:e.city,province:e.stateOrProvince,provinceCode:e.stateOrProvinceCode,postCode:e.postalCode,country:e.country,countryCode:e.countryCode,phone:e.phone,customFields:e.customFields}}e.r(t),e.d(t,{CacheKeyResolver:()=>b,mapToInternalAddress:()=>n,mapToInternalCart:()=>p,mapToInternalCoupon:()=>a,mapToInternalCustomer:()=>m,mapToInternalGiftCertificate:()=>s,mapToInternalLineItem:()=>c,mapToInternalLineItems:()=>d,mapToInternalOrder:()=>l,mapToInternalQuote:()=>I,mapToInternalShippingOption:()=>v,mapToInternalShippingOptions:()=>A});const i=require("lodash"),o=function(){function e(e){this._decimalPlaces=e}return e.prototype.toInteger=function(e){return Math.round(e*Math.pow(10,this._decimalPlaces))},e}();var r=["per_item_discount","percentage_discount","per_total_discount","shipping_discount","free_shipping"];function a(e){return{code:e.code,discount:e.displayName,discountType:r.indexOf(e.couponType)}}function s(e){return{code:e.code,discountedAmount:e.used,remainingBalance:e.remaining,giftCertificate:{balance:e.balance,code:e.code,purchaseDate:e.purchaseDate}}}const u=require("tslib");function c(e,t,n,i){void 0===i&&(i="id");var r=new o(n);return{id:e[i],imageUrl:e.imageUrl,amount:e.extendedListPrice,amountAfterDiscount:e.extendedSalePrice,discount:e.discountAmount,integerAmount:r.toInteger(e.extendedListPrice),integerAmountAfterDiscount:r.toInteger(e.extendedSalePrice),integerDiscount:r.toInteger(e.discountAmount),integerUnitPrice:r.toInteger(e.listPrice),integerUnitPriceAfterDiscount:r.toInteger(e.salePrice),downloadsPageUrl:e.downloadPageUrl,name:e.name,quantity:e.quantity,brand:e.brand,sku:e.sku,categoryNames:e.categoryNames,variantId:e.variantId,productId:e.productId,attributes:(e.options||[]).map((function(e){return{name:e.name,value:e.value}})),addedByPromotion:e.addedByPromotion,type:t}}function d(e,t,n){return void 0===n&&(n="id"),Object.keys(e).reduce((function(i,r){return(0,u.__spreadArrays)(i,e[r].map((function(e){return"giftCertificates"===r?function(e,t){var n=new o(t);return{id:e.id,imageUrl:"",name:e.name,amount:e.amount,amountAfterDiscount:e.amount,discount:0,integerAmount:n.toInteger(e.amount),integerAmountAfterDiscount:n.toInteger(e.amount),integerUnitPrice:n.toInteger(e.amount),integerUnitPriceAfterDiscount:n.toInteger(e.amount),integerDiscount:0,quantity:1,sender:e.sender,recipient:e.recipient,type:"ItemGiftCertificateEntity",attributes:[],variantId:null}}(e,t):c(e,function(e){switch(e){case"physicalItems":return"ItemPhysicalEntity";case"digitalItems":return"ItemDigitalEntity";case"giftCertificates":return"ItemGiftCertificateEntity";default:return""}}(r),t,n)})))}),[])}function p(e){var t,n,r=e.cart.currency.decimalPlaces,u=new o(r);return{id:e.cart.id,items:d(e.cart.lineItems,r),currency:e.cart.currency.code,coupon:{discountedAmount:(0,i.reduce)(e.cart.coupons,(function(e,t){return e+t.discountedAmount}),0),coupons:e.cart.coupons.map(a)},discount:{amount:e.cart.discountAmount,integerAmount:u.toInteger(e.cart.discountAmount)},discountNotifications:(t=e.promotions,n=[],(t||[]).forEach((function(e){(e.banners||[]).forEach((function(e){n.push({placeholders:[],discountType:null,message:"",messageHtml:e.text})}))})),n),giftCertificate:{totalDiscountedAmount:(0,i.reduce)(e.giftCertificates,(function(e,t){return e+t.used}),0),appliedGiftCertificates:(0,i.keyBy)(e.giftCertificates.map(s),"code")},shipping:{amount:e.shippingCostTotal,integerAmount:u.toInteger(e.shippingCostTotal),amountBeforeDiscount:e.shippingCostBeforeDiscount,integerAmountBeforeDiscount:u.toInteger(e.shippingCostBeforeDiscount),required:(0,i.some)(e.cart.lineItems.physicalItems,(function(e){return e.isShippingRequired}))},subtotal:{amount:e.subtotal,integerAmount:u.toInteger(e.subtotal)},storeCredit:{amount:e.customer?e.customer.storeCredit:0},taxSubtotal:{amount:e.taxTotal,integerAmount:u.toInteger(e.taxTotal)},taxes:e.taxes,taxTotal:{amount:e.taxTotal,integerAmount:u.toInteger(e.taxTotal)},handling:{amount:e.handlingCostTotal,integerAmount:u.toInteger(e.handlingCostTotal)},grandTotal:{amount:e.grandTotal,integerAmount:u.toInteger(e.grandTotal)}}}function m(e,t){var i=e.firstName||t.firstName||"",o=e.lastName||t.lastName||"";return{addresses:(e.addresses||[]).map((function(e){return n(e)})),customerId:e.id,isGuest:e.isGuest,storeCredit:e.storeCredit,email:e.email||t.email||"",firstName:i,lastName:o,name:e.fullName||[i,o].join(" "),customerGroupName:e.customerGroup&&e.customerGroup.name}}function l(e,t){void 0===t&&(t={});var n,r,s=e.currency.decimalPlaces,u=new o(s);return{id:e.orderId,items:d(e.lineItems,e.currency.decimalPlaces,"productId"),orderId:e.orderId,currency:e.currency.code,customerCanBeCreated:e.customerCanBeCreated,payment:f(e.payments,t.payment),subtotal:{amount:e.baseAmount,integerAmount:u.toInteger(e.baseAmount)},coupon:{discountedAmount:(0,i.reduce)(e.coupons,(function(e,t){return e+t.discountedAmount}),0),coupons:e.coupons.map(a)},discount:{amount:e.discountAmount,integerAmount:u.toInteger(e.discountAmount)},token:t.orderToken,callbackUrl:t.callbackUrl,discountNotifications:[],giftCertificate:(n=e.payments,r=(0,i.filter)(n,{providerId:"giftcertificate"}),{totalDiscountedAmount:(0,i.reduce)(r,(function(e,t){return t.amount+e}),0),appliedGiftCertificates:(0,i.keyBy)(r.map((function(e){return{code:e.detail.code,discountedAmount:e.amount,remainingBalance:e.detail.remaining,giftCertificate:{balance:e.amount+e.detail.remaining,code:e.detail.code,purchaseDate:""}}})),"code")}),socialData:y(e),status:e.status,hasDigitalItems:e.hasDigitalItems,isDownloadable:e.isDownloadable,isComplete:e.isComplete,shipping:{amount:e.shippingCostTotal,integerAmount:u.toInteger(e.shippingCostTotal),amountBeforeDiscount:e.shippingCostBeforeDiscount,integerAmountBeforeDiscount:u.toInteger(e.shippingCostBeforeDiscount)},storeCredit:{amount:g(e.payments)},taxes:e.taxes,taxTotal:{amount:e.taxTotal,integerAmount:u.toInteger(e.taxTotal)},handling:{amount:e.handlingCostTotal,integerAmount:u.toInteger(e.handlingCostTotal)},grandTotal:{amount:e.orderAmount,integerAmount:e.orderAmountAsInteger}}}function g(e){var t=(0,i.find)(e,{providerId:"storecredit"});return t?t.amount:0}function f(e,t){void 0===t&&(t={});var n,o=(0,i.find)(e,h);return o?{id:o.providerId,status:(n=o.detail.step,"PAYMENT_STATUS_"+n),helpText:o.detail.instructions,returnUrl:t.returnUrl}:{}}function h(e){return"giftcertificate"!==e.providerId&&"storecredit"!==e.providerId}function y(e){var t={};return(0,u.__spreadArrays)(e.lineItems.physicalItems,e.lineItems.digitalItems).forEach((function(e){var n;t[e.id]=(n=e,["fb","tw","gp"].reduce((function(e,t){var o=n.socialMedia&&(0,i.find)(n.socialMedia,(function(e){return e.code===t}));return o?(e[t]={name:n.name,description:n.name,image:n.imageUrl,url:o.link,shareText:o.text,sharingLink:o.link,channelName:o.channel,channelCode:o.code},e):e}),{}))})),t}function I(e,t){var i=e.consignments&&e.consignments[0];return{orderComment:e.customerMessage,shippingOption:i&&i.selectedShippingOption?i.selectedShippingOption.id:void 0,billingAddress:e.billingAddress?n(e.billingAddress):{},shippingAddress:t&&n(t,e.consignments)}}function v(e,t){return{description:e.description,module:e.type,price:e.cost,id:e.id,selected:t,isRecommended:e.isRecommended,imageUrl:e.imageUrl,transitTime:e.transitTime}}function A(e){return e.reduce((function(e,t){var n,i;return t.availableShippingOptions&&t.availableShippingOptions.length?i=t.availableShippingOptions:t.selectedShippingOption&&(i=[t.selectedShippingOption]),(0,u.__assign)((0,u.__assign)({},e),((n={})[t.id]=(i||[]).map((function(e){var n=t.selectedShippingOption&&t.selectedShippingOption.id;return v(e,e.id===n)})),n))}),{})}const C=require("shallowequal");var _=e.n(C);function T(e){return Object.prototype.hasOwnProperty.call(e,"cacheKey")}const b=function(){function e(e){this._lastId=0,this._map={maps:[]},this._usedMaps=[],this._options=(0,u.__assign)({maxSize:0,isEqual:_(),onExpire:i.noop},e)}return e.prototype.getKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._resolveMap.apply(this,e),i=n.index,o=n.parentMap,r=n.map;return r&&r.cacheKey?r.usedCount++:r=this._generateMap(o,e.slice(i)),this._removeLeastUsedMap(r),r.cacheKey},e.prototype.getUsedCount=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._resolveMap.apply(this,e).map;return n?n.usedCount:0},e.prototype._resolveMap=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var i=0,o=this._map;o.maps.length;){for(var r=!1,a=0;a<o.maps.length;a++){var s=o.maps[a];if(this._options.isEqual(s.value,t[i])){if((e=o.maps).unshift.apply(e,o.maps.splice(a,1)),(0===t.length||i===t.length-1)&&T(s))return{index:i,map:s,parentMap:o};r=!0,o=s,i++;break}}if(!r)break}return{index:i,parentMap:o}},e.prototype._generateMap=function(e,t){var n,i=0,o=e;do{n={maps:[],parentMap:o,usedCount:1,value:t[i]},o.maps.unshift(n),o=n,i++}while(i<t.length);var r=n;return r.cacheKey=""+ ++this._lastId,r},e.prototype._removeLeastUsedMap=function(e){if(this._options.maxSize){var t=this._usedMaps.indexOf(e);if(this._usedMaps.splice(-1===t?0:t,-1===t?0:1,e),!(this._usedMaps.length<=this._options.maxSize)){var n=this._usedMaps.pop();n&&(this._removeMap(n),this._options.onExpire(n.cacheKey))}}},e.prototype._removeMap=function(e){e.parentMap&&(e.parentMap.maps.splice(e.parentMap.maps.indexOf(e),1),function(e){return Object.prototype.hasOwnProperty.call(e,"parentMap")}(e.parentMap)||this._removeMap(e.parentMap))},e}();module.exports=t})();
//# sourceMappingURL=internal-mappers.js.map