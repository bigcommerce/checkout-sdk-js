(()=>{"use strict";var e={483:e=>{e.exports=require("iframe-resizer")},405:e=>{e.exports=require("iframe-resizer/js/iframeResizer.contentWindow")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};n.r(r),n.d(r,{ExtensionCommandType:()=>_,ExtensionEventType:()=>E,initializeExtensionService:()=>w});const i=require("tslib"),o=function(e,t,n){return t&&n?s(0,t,n):function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t}(e);return Object.getOwnPropertyNames(e.prototype).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e.prototype,n);r&&"constructor"!==n&&Object.defineProperty(t.prototype,n,s(e.prototype,n,r))})),t}(e)};function s(e,t,n){if("function"!=typeof n.value)return n;var r=n.value;return{get:function(){var e=r.bind(this);return Object.defineProperty(this,t,(0,i.__assign)((0,i.__assign)({},n),{value:e})),e},set:function(e){r=e}}}const a=function(e){function t(t){var n=e.call(this,t||"Invalid arguments have been provided.")||this;return n.name="InvalidArgumentError",n.type="invalid_argument",n}return(0,i.__extends)(t,e),t}(function(e){function t(t){var n,r,i=this.constructor,o=e.call(this,t||"An unexpected error has occurred.")||this;return o.name="StandardError",o.type="standard",n=o,r=i.prototype,Object.setPrototypeOf?Object.setPrototypeOf(n,r):n.__proto__=r,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(o,i):o.stack=new Error(o.message).stack,o}return(0,i.__extends)(t,e),t}(Error));function u(e){if(!/^(https?:)?\/\//.test(e))throw new a("The provided URL must be absolute.");var t=document.createElement("a");t.href=e;var n=t.port&&-1!==e.indexOf(t.hostname+":"+t.port)?t.port:"";return{hash:t.hash,hostname:t.hostname,href:t.href,origin:t.protocol+"//"+t.hostname+(n?":"+n:""),pathname:t.pathname,port:n,protocol:t.protocol,search:t.search}}function c(e,t){return e.type===t}const d=function(){function e(e){var t;this._sourceOrigins=[u(e).origin,(t=u(e),u(0===t.hostname.indexOf("www")?t.href:t.href.replace(t.hostname,"www."+t.hostname))).origin],this._isListening=!1,this._listeners={}}return e.prototype.listen=function(){this._isListening||(this._isListening=!0,window.addEventListener("message",this._handleMessage))},e.prototype.stopListen=function(){this._isListening&&(this._isListening=!1,window.removeEventListener("message",this._handleMessage))},e.prototype.addListener=function(e,t){var n=this._listeners[e];n||(this._listeners[e]=n=[]),-1===n.indexOf(t)&&n.push(t)},e.prototype.removeListener=function(e,t){var n=this._listeners[e];if(n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}},e.prototype.trigger=function(e,t){var n=this._listeners[e.type];n&&n.forEach((function(n){return t?n(e,t):n(e)}))},e.prototype._handleMessage=function(e){if(-1!==this._sourceOrigins.indexOf(e.origin)&&c(e.data,e.data.type)){var t=e.data,n=t.context,r=(0,i.__rest)(t,["context"]);this.trigger(r,n)}},(0,i.__decorate)([o],e.prototype,"_handleMessage",null),e}(),p=require("rxjs"),h=require("rxjs/operators"),f=function(){function e(e,t,n){this._targetWindow=t,this._context=n,this._targetOrigin="*"===e?"*":u(e).origin}return e.prototype.post=function(e,t){var n=this,r=this._targetWindow;if(window!==r){if(!r)throw new Error("Unable to post message because target window is not set.");var o=t&&(0,p.fromEvent)(window,"message").pipe((0,h.filter)((function(e){return e.origin===n._targetOrigin&&c(e.data,e.data.type)&&-1!==[t.successType,t.errorType].indexOf(e.data.type)})),(0,h.map)((function(e){if(t.errorType===e.data.type)throw e.data;return e.data})),(0,h.take)(1)).toPromise();return r.postMessage((0,i.__assign)((0,i.__assign)({},e),{context:this._context}),this._targetOrigin),o}},e.prototype.setTarget=function(e){this._targetWindow=e},e.prototype.setContext=function(e){this._context=e},e}(),l=require("lodash");var _,E,m,g;!function(e){e.ReloadCheckout="EXTENSION:RELOAD_CHECKOUT",e.ShowLoadingIndicator="EXTENSION:SHOW_LOADING_INDICATOR",e.SetIframeStyle="EXTENSION:SET_IFRAME_STYLE"}(_||(_={})),function(e){e.ConsignmentsChanged="EXTENSION:CONSIGNMENTS_CHANGED"}(E||(E={})),function(e){e.Subscribe="EXTENSION_INTERNAL:SUBSCRIBE",e.Unsubscribe="EXTENSION_INTERNAL:UNSUBSCRIBE",e.ResizeIframe="EXTENSION_INTERNAL:RESIZE_IFRAME"}(m||(m={})),function(e){e.ExtensionReady="EXTENSION:READY",e.ExtensionFailed="EXTENSION:FAILED"}(g||(g={}));const y=function(){function e(e,t,n){this._eventListener=e,this._commandPoster=t,this._internalCommandPoster=n,this._commandPoster.setTarget(window.parent),this._internalCommandPoster.setTarget(window.parent)}return e.prototype.initialize=function(e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:if(!e)throw new Error("Extension Id not found.");this._extensionId=e,this._eventListener.listen(),this._commandPoster.setContext({extensionId:e}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._internalCommandPoster.post({type:m.ResizeIframe,payload:{extensionId:e}},{successType:g.ExtensionReady,errorType:g.ExtensionFailed})];case 2:return n.sent(),[3,4];case 3:if(t=n.sent(),this._isExtensionFailedEvent(t))throw new Error("Extension failed to load within 60 seconds; please reload and try again.");return[3,4];case 4:return[2]}}))}))},e.prototype.post=function(e){if(!Object.values(_).includes(e.type))throw new Error(e.type+" is not supported.");this._commandPoster.post(e)},e.prototype.addListener=function(e,t){var n=this;if(void 0===t&&(t=l.noop),!this._extensionId)throw new Error("Extension is not initialized.");var r=this._extensionId;if(!Object.values(E).includes(e))throw new Error(e+" is not supported.");return this._internalCommandPoster.post({type:m.Subscribe,payload:{extensionId:r,eventType:e}}),this._eventListener.addListener(e,t),function(){n._internalCommandPoster.post({type:m.Unsubscribe,payload:{extensionId:r,eventType:e}}),n._eventListener.removeListener(e,t)}},e.prototype._isExtensionFailedEvent=function(e){return e.type===g.ExtensionFailed},e}();function w(e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t,r,o,s,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return t=e.extensionId,r=e.parentOrigin,o=e.taggedElementId,s=e.fixedHeight,n(405),[4,(a=new y(new d(r),new f(r),new f(r))).initialize(t)];case 1:return i.sent(),function(e,t){if(!function(e){return"parentIFrame"in e}(window))throw new Error("iFramerResizer window not found.");if(t)window.parentIFrame.size(t);else if(window.parentIFrame.autoResize(!0),e){var n=document.getElementById(e);if(!n)throw new Error("Element not found.");n.setAttribute("data-iframe-height",""),window.parentIFrame.setHeightCalculationMethod("taggedElement")}else window.parentIFrame.setHeightCalculationMethod("bodyOffset")}(o,s),[2,a]}}))}))}module.exports=r})();
//# sourceMappingURL=extension.js.map