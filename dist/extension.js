(()=>{"use strict";var t={483:t=>{t.exports=require("iframe-resizer")},405:t=>{t.exports=require("iframe-resizer/js/iframeResizer.contentWindow")}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};n.r(r),n.d(r,{ExtensionCommandType:()=>m,ExtensionEventType:()=>O,initializeExtensionService:()=>C});var o,i=(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)};const a=function(t,e,n){return e&&n?c(0,e,n):function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(t);return Object.getOwnPropertyNames(t.prototype).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t.prototype,n);r&&"constructor"!==n&&Object.defineProperty(e.prototype,n,c(t.prototype,n,r))})),e}(t)};function c(t,e,n){if("function"!=typeof n.value)return n;var r=n.value;return{get:function(){var t=r.bind(this);return Object.defineProperty(this,e,s(s({},n),{value:t})),t},set:function(t){r=t}}}var u=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const p=function(t){function e(e){var n,r,o=this.constructor,i=t.call(this,e||"An unexpected error has occurred.")||this;return i.name="StandardError",i.type="standard",n=i,r=o.prototype,Object.setPrototypeOf?Object.setPrototypeOf(n,r):n.__proto__=r,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(i,o):i.stack=new Error(i.message).stack,i}return u(e,t),e}(Error);var f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const l=function(t){function e(e){var n=t.call(this,e||"Invalid arguments have been provided.")||this;return n.name="InvalidArgumentError",n.type="invalid_argument",n}return f(e,t),e}(p);function h(t){if(!/^(https?:)?\/\//.test(t))throw new l("The provided URL must be absolute.");var e=document.createElement("a");e.href=t;var n=e.port&&-1!==t.indexOf("".concat(e.hostname,":").concat(e.port))?e.port:"";return{hash:e.hash,hostname:e.hostname,href:e.href,origin:"".concat(e.protocol,"//").concat(e.hostname).concat(n?":".concat(n):""),pathname:e.pathname,port:n,protocol:e.protocol,search:e.search}}function d(t,e){return t.type===e}const y=function(){function t(t){var e;this._sourceOrigins=[h(t).origin,(e=h(t),h(0===e.hostname.indexOf("www")?e.href:e.href.replace(e.hostname,"www.".concat(e.hostname)))).origin],this._isListening=!1,this._listeners={}}return t.prototype.listen=function(){this._isListening||(this._isListening=!0,window.addEventListener("message",this._handleMessage))},t.prototype.stopListen=function(){this._isListening&&(this._isListening=!1,window.removeEventListener("message",this._handleMessage))},t.prototype.addListener=function(t,e){var n=this._listeners[t];n||(this._listeners[t]=n=[]),-1===n.indexOf(e)&&n.push(e)},t.prototype.removeListener=function(t,e){var n=this._listeners[t];if(n){var r=n.indexOf(e);r>=0&&n.splice(r,1)}},t.prototype.trigger=function(t,e){var n=this._listeners[t.type];n&&n.forEach((function(n){return e?n(t,e):n(t)}))},t.prototype._handleMessage=function(t){if(-1!==this._sourceOrigins.indexOf(t.origin)&&d(t.data,t.data.type)){var e=t.data,n=e.context,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(e,["context"]);this.trigger(r,n)}},function(t,e,n,r){var o,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);i>3&&s&&Object.defineProperty(e,n,s)}([a],t.prototype,"_handleMessage",null),t}(),v=require("rxjs"),w=require("rxjs/operators");var g=function(){return g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},g.apply(this,arguments)};const E=function(){function t(t,e,n){this._targetWindow=e,this._context=n,this._targetOrigin="*"===t?"*":h(t).origin}return t.prototype.post=function(t,e){var n=this,r=this._targetWindow;if(window!==r){if(!r)throw new Error("Unable to post message because target window is not set.");var o=e&&(0,v.fromEvent)(window,"message").pipe((0,w.filter)((function(t){return t.origin===n._targetOrigin&&d(t.data,t.data.type)&&-1!==[e.successType,e.errorType].indexOf(t.data.type)})),(0,w.map)((function(t){if(e.errorType===t.data.type)throw t.data;return t.data})),(0,w.take)(1)).toPromise();return r.postMessage(g(g({},t),{context:this._context}),this._targetOrigin),o}},t.prototype.setTarget=function(t){this._targetWindow=t},t.prototype.setContext=function(t){this._context=t},t}(),_=require("lodash");var m,O,b,x,I;!function(t){t.ReloadCheckout="EXTENSION:RELOAD_CHECKOUT",t.ShowLoadingIndicator="EXTENSION:SHOW_LOADING_INDICATOR",t.SetIframeStyle="EXTENSION:SET_IFRAME_STYLE",t.ReRenderShippingForm="EXTENSION:RE_RENDER_SHIPPING_FORM"}(m||(m={})),function(t){t.ConsignmentsChanged="EXTENSION:CONSIGNMENTS_CHANGED"}(O||(O={})),function(t){t.Subscribe="EXTENSION_INTERNAL:SUBSCRIBE",t.Unsubscribe="EXTENSION_INTERNAL:UNSUBSCRIBE",t.ResizeIframe="EXTENSION_INTERNAL:RESIZE_IFRAME"}(b||(b={})),function(t){t.ExtensionReady="EXTENSION:READY",t.ExtensionFailed="EXTENSION:FAILED"}(x||(x={})),function(t){t.GetConsignments="EXTENSION:GET_CONSIGNMENTS"}(I||(I={}));var S=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},N=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};const T=function(){function t(t,e,n,r){this._messageListener=t,this._eventListener=e,this._messagePoster=n,this._internalCommandPoster=r,this._messagePoster.setTarget(window.parent),this._internalCommandPoster.setTarget(window.parent)}return t.prototype.initialize=function(t){return S(this,void 0,void 0,(function(){var e;return N(this,(function(n){switch(n.label){case 0:if(!t)throw new Error("Extension Id not found.");this._extensionId=t,this._messageListener.listen(),this._eventListener.listen(),this._messagePoster.setContext({extensionId:t}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._internalCommandPoster.post({type:b.ResizeIframe,payload:{extensionId:t}},{successType:x.ExtensionReady,errorType:x.ExtensionFailed})];case 2:return n.sent(),[3,4];case 3:if(e=n.sent(),this._isExtensionFailedEvent(e))throw new Error("Extension failed to load within 60 seconds; please reload and try again.");return[3,4];case 4:return[2]}}))}))},t.prototype.post=function(t){if(!this._isCommandOrQueryType(t.type))throw new Error("".concat(t.type," is not supported."));this._messagePoster.post(t)},t.prototype.addListener=function(t,e){var n=this;if(void 0===e&&(e=_.noop),!this._extensionId)throw new Error("Extension is not initialized.");var r=this._extensionId;if(!Object.values(O).includes(t))throw new Error("".concat(t," is not supported."));return this._internalCommandPoster.post({type:b.Subscribe,payload:{extensionId:r,eventType:t}}),this._eventListener.addListener(t,e),function(){n._internalCommandPoster.post({type:b.Unsubscribe,payload:{extensionId:r,eventType:t}}),n._eventListener.removeListener(t,e)}},t.prototype.getConsignments=function(t){return void 0===t&&(t=!0),S(this,void 0,void 0,(function(){var e=this;return N(this,(function(n){return[2,new Promise((function(n){var r=function(t){e._messageListener.removeListener("EXTENSION:GET_CONSIGNMENTS",r),n(t.payload.consignments)};e._messageListener.addListener("EXTENSION:GET_CONSIGNMENTS",r),e.post({type:I.GetConsignments,payload:{useCache:t}})}))]}))}))},t.prototype._isExtensionFailedEvent=function(t){return t.type===x.ExtensionFailed},t.prototype._isCommandOrQueryType=function(t){return Object.values(m).includes(t)||Object.values(I).includes(t)},t}();var P=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},j=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function C(t){return P(this,void 0,void 0,(function(){var e,r,o,i,s;return j(this,(function(a){switch(a.label){case 0:return e=t.extensionId,r=t.parentOrigin,o=t.taggedElementId,i=t.fixedHeight,n(405),[4,(s=new T(new y(r),new y(r),new E(r),new E(r))).initialize(e)];case 1:return a.sent(),function(t,e){if(!function(t){return"parentIFrame"in t}(window))throw new Error("iFramerResizer window not found.");if(e)window.parentIFrame.size(e);else if(window.parentIFrame.autoResize(!0),t){var n=document.getElementById(t);if(!n)throw new Error("Element not found.");n.setAttribute("data-iframe-height",""),window.parentIFrame.setHeightCalculationMethod("taggedElement")}else window.parentIFrame.setHeightCalculationMethod("bodyOffset")}(o,i),[2,s]}}))}))}module.exports=r})();
//# sourceMappingURL=extension.js.map