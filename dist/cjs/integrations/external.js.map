{"version":3,"file":"integrations/external.js","mappings":"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","sources":["webpack://@bigcommerce/checkout-sdk/../src/form-poster.ts","webpack://@bigcommerce/checkout-sdk/../src/index.ts","webpack://@bigcommerce/checkout-sdk/../src/create-form-poster.ts","webpack://@bigcommerce/checkout-sdk/../src/url-utils.ts","webpack://@bigcommerce/checkout-sdk/../src/form-builder.ts","webpack://@bigcommerce/checkout-sdk/webpack/bootstrap","webpack://@bigcommerce/checkout-sdk/webpack/runtime/define property getters","webpack://@bigcommerce/checkout-sdk/webpack/runtime/hasOwnProperty shorthand","webpack://@bigcommerce/checkout-sdk/webpack/runtime/make namespace object","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/standard-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/set-prototype-of.ts","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/invalid-argument-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/payment-argument-invalid-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/order-finalization-not-required-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/external-integration/src/external-payment-strategy.ts","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/errors/is-request-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/external-integration/src/is-additional-action.ts","webpack://@bigcommerce/checkout-sdk/./packages/external-integration/src/create-external-payment-strategy.ts","webpack://@bigcommerce/checkout-sdk/./packages/payment-integration-api/src/to-resolvable-module.ts"],"sourcesContent":["import FormBuilder from './form-builder';\nimport FormPosterOptions from './form-poster-options';\nimport { isAbsoluteUrl, joinPaths } from './url-utils';\n\nexport default class FormPoster {\n    /**\n     * @internal\n     */\n    constructor(\n        private _formBuilder: FormBuilder,\n        private _options?: FormPosterOptions\n    ) {}\n\n    postForm(url: string, data: { [key: string]: any }, callback?: () => void, target?: string): void {\n        const form = this._formBuilder.build(this._prependHost(url), data, target);\n\n        window.addEventListener('unload', function handleUnload() {\n            window.removeEventListener('unload', handleUnload);\n\n            if (callback) {\n                callback();\n            }\n        });\n\n        // In order to submit the form, the form must be attached to DOM.\n        document.body.appendChild(form);\n        form.submit();\n    }\n\n    private _prependHost(url: string): string {\n        if (!this._options || !this._options.host || isAbsoluteUrl(url)) {\n            return url;\n        }\n\n        return joinPaths(this._options.host, url);\n    }\n}\n","export { default as createFormPoster } from './create-form-poster';\nexport { default as FormPoster } from './form-poster';\n","import FormBuilder from './form-builder';\nimport FormPoster from './form-poster';\nimport FormPosterOptions from './form-poster-options';\n\nexport default function createFormPoster(options?: FormPosterOptions): FormPoster {\n    const formBuilder = new FormBuilder();\n    const formPoster = new FormPoster(formBuilder, options);\n\n    return formPoster;\n}\n","export function isAbsoluteUrl(url: string): boolean {\n    return /^https?:\\/\\//.test(url);\n}\n\nexport function joinPaths(pathA: string, pathB: string): string {\n    return `${removeTrailingSlash(pathA)}/${removeLeadingSlash(pathB)}`;\n}\n\nfunction removeTrailingSlash(path: string): string {\n    return path.replace(/\\/$/, '');\n}\n\nfunction removeLeadingSlash(path: string): string {\n    return path.replace(/^\\//, '');\n}\n","export default class FormBuilder {\n    build(url: string, data: { [key: string]: any }, target?: string): HTMLFormElement {\n        const form = document.createElement('form');\n\n        form.style.display = 'none';\n\n        form.setAttribute('action', url);\n        form.setAttribute('method', 'POST');\n        form.setAttribute('target', target || '_top');\n\n        Object.keys(data)\n            .forEach(key => {\n                const value = data[key];\n\n                form.appendChild(this._createInput(value, key));\n            });\n\n        return form;\n    }\n\n    private _createInput(value: any, key: string): HTMLInputElement {\n        const input = document.createElement('input');\n\n        input.setAttribute('name', key);\n        input.setAttribute('type', 'hidden');\n        input.setAttribute('value', value);\n\n        return input;\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import CustomError from './custom-error';\nimport setPrototypeOf from './set-prototype-of';\n\n/**\n * This error type should not be constructed directly. It is a base class for\n * all custom errors thrown in this library.\n */\nexport default abstract class StandardError extends Error implements CustomError {\n    name = 'StandardError';\n    type = 'standard';\n\n    constructor(message?: string) {\n        super(message || 'An unexpected error has occurred.');\n\n        setPrototypeOf(this, new.target.prototype);\n\n        if (typeof Error.captureStackTrace === 'function') {\n            Error.captureStackTrace(this, new.target);\n        } else {\n            this.stack = new Error(this.message).stack;\n        }\n    }\n}\n","export default function setPrototypeOf(object: any, prototype: object) {\n    if (Object.setPrototypeOf) {\n        Object.setPrototypeOf(object, prototype);\n    } else {\n        object.__proto__ = prototype;\n    }\n\n    return object;\n}\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when a method is unable to proceed because the\n * caller has not provided all the arguments according to their requirements,\n * i.e.: if an argument is missing or it is not the expected data type.\n */\nexport default class InvalidArgumentError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Invalid arguments have been provided.');\n\n        this.name = 'InvalidArgumentError';\n        this.type = 'invalid_argument';\n    }\n}\n","import InvalidArgumentError from './invalid-argument-error';\n\n/**\n * This error should be thrown when we are unable to submit a payment because\n * the caller has not provided all the required fields, i.e.: if an argument is\n * missing or it is not the expected data type.\n */\nexport default class PaymentArgumentInvalidError extends InvalidArgumentError {\n    constructor(invalidFields?: string[]) {\n        let message = 'Unable to submit payment for the order because the payload is invalid.';\n\n        if (invalidFields) {\n            message = `${message} Make sure the following fields are provided correctly: ${invalidFields.join(\n                ', ',\n            )}.`;\n        }\n\n        super(message);\n\n        this.name = 'PaymentArgumentInvalidError';\n    }\n}\n","import StandardError from './standard-error';\n\n/**\n * Throw this error if we are trying to make an order finalization request for a\n * payment method that does not require such procedure.\n */\nexport default class OrderFinalizationNotRequiredError extends StandardError {\n    constructor() {\n        super('The current order does not need to be finalized at this stage.');\n\n        this.name = 'OrderFinalizationNotRequiredError';\n        this.type = 'order_finalization_not_required';\n    }\n}\n","import { FormPoster } from '@bigcommerce/form-poster';\n\nimport {\n    isRequestError,\n    OrderFinalizationNotRequiredError,\n    OrderRequestBody,\n    PaymentArgumentInvalidError,\n    PaymentIntegrationService,\n    PaymentRequestOptions,\n    PaymentStrategy,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { AdditionalActionRequired, isAdditionalActionRequired } from './is-additional-action';\n\nexport default class ExternalPaymentStrategy implements PaymentStrategy {\n    constructor(\n        private _formPoster: FormPoster,\n        private _paymentIntegrationService: PaymentIntegrationService,\n    ) {}\n\n    async execute(payload: OrderRequestBody, options?: PaymentRequestOptions): Promise<void> {\n        const { payment, ...order } = payload;\n        const paymentData = payment && payment.paymentData;\n\n        if (!payment || !paymentData) {\n            throw new PaymentArgumentInvalidError(['payment.paymentData']);\n        }\n\n        await this._paymentIntegrationService.submitOrder(order, options);\n\n        try {\n            await this._paymentIntegrationService.submitPayment({ ...payment, paymentData });\n        } catch (error) {\n            if (\n                !isRequestError(error) ||\n                !isAdditionalActionRequired(error.body) ||\n                !this._isAdditionalActionRequired(error.body)\n            ) {\n                return Promise.reject(error);\n            }\n\n            const {\n                body: {\n                    additional_action_required: {\n                        data: { redirect_url },\n                    },\n                },\n            } = error;\n\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            return new Promise(() => {\n                this.redirectUrl(redirect_url);\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            }) as any;\n        }\n    }\n\n    finalize(): Promise<void> {\n        return Promise.reject(new OrderFinalizationNotRequiredError());\n    }\n\n    initialize(): Promise<void> {\n        return Promise.resolve();\n    }\n\n    deinitialize(): Promise<void> {\n        return Promise.resolve();\n    }\n\n    protected redirectUrl(redirect_url: string): void {\n        return this._formPoster.postForm(redirect_url, {});\n    }\n\n    private _isAdditionalActionRequired(body: AdditionalActionRequired): boolean {\n        const { additional_action_required, status } = body;\n\n        return (\n            status === 'additional_action_required' &&\n            additional_action_required &&\n            additional_action_required.type === 'offsite_redirect'\n        );\n    }\n}\n","import RequestError from './request-error';\n\n// Have to use `as` https://stackoverflow.com/questions/73987044/typeguarding-an-unknown-nested-object should be fixed in 4.8+\nconst isRequestError = (error: unknown): error is RequestError => {\n    return typeof error === 'object' && error !== null && 'body' in error;\n};\n\nexport default isRequestError;\n","export interface AdditionalActionRequired {\n    additional_action_required: {\n        data: {\n            redirect_url: string;\n        };\n        type: string;\n    };\n    status: string;\n}\n\nexport function isAdditionalActionRequired(value: unknown): value is AdditionalActionRequired {\n    return typeof value === 'object' && value !== null && 'additional_action_required' in value;\n}\n","import { createFormPoster } from '@bigcommerce/form-poster';\n\nimport {\n    PaymentStrategyFactory,\n    toResolvableModule,\n} from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport ExternalPaymentStrategy from './external-payment-strategy';\n\nconst createExternalPaymentStrategy: PaymentStrategyFactory<ExternalPaymentStrategy> = (\n    paymentIntegrationService,\n) => new ExternalPaymentStrategy(createFormPoster(), paymentIntegrationService);\n\nexport default toResolvableModule(createExternalPaymentStrategy, [{ id: 'laybuy' }]);\n","import ResolvableModule from './resolvable-module';\n\nexport default function toResolvableModule<TModule, TIdentifier>(\n    module: TModule,\n    resolveIds: TIdentifier[],\n): ResolvableModule<TModule, TIdentifier> {\n    return Object.assign(module, { resolveIds });\n}\n"],"names":["_formBuilder","_options","postForm","url","data","callback","target","form","this","build","_prependHost","window","addEventListener","handleUnload","removeEventListener","document","body","appendChild","submit","host","isAbsoluteUrl","joinPaths","default","options","formBuilder","test","pathA","pathB","path","replace","removeLeadingSlash","createElement","style","display","setAttribute","Object","keys","forEach","key","value","_createInput","input","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","StandardError","Error","constructor","message","super","name","type","setPrototypeOf","__proto__","captureStackTrace","stack","InvalidArgumentError","PaymentArgumentInvalidError","invalidFields","join","OrderFinalizationNotRequiredError","ExternalPaymentStrategy","_formPoster","_paymentIntegrationService","execute","payload","payment","order","paymentData","submitOrder","submitPayment","error","_isAdditionalActionRequired","Promise","reject","additional_action_required","redirect_url","redirectUrl","finalize","initialize","resolve","deinitialize","status","assign","paymentIntegrationService","createFormPoster","resolveIds","id"],"sourceRoot":""}