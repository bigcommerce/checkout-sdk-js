import*as e from"iframe-resizer";import*as t from"iframe-resizer/js/iframeResizer.contentWindow";import{fromEvent as n}from"rxjs";import{filter as r,map as s,take as i}from"rxjs/operators";import{noop as o}from"lodash";var a={785:t=>{t.exports=e},939:e=>{e.exports=t}},c={};function d(e){var t=c[e];if(void 0!==t)return t.exports;var n=c[e]={exports:{}};return a[e](n,n.exports,d),n.exports}d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);function p(e,t,n){if("function"!=typeof n.value)return n;let r=n.value;return{get(){const e=r.bind(this);return Object.defineProperty(this,t,Object.assign(Object.assign({},n),{value:e})),e},set(e){r=e}}}class h extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class u extends h{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}function f(e){if(!/^(https?:)?\/\//.test(e))throw new u("The provided URL must be absolute.");const t=document.createElement("a");t.href=e;const n=t.port&&-1!==e.indexOf(`${t.hostname}:${t.port}`)?t.port:"";return{hash:t.hash,hostname:t.hostname,href:t.href,origin:`${t.protocol}//${t.hostname}${n?`:${n}`:""}`,pathname:t.pathname,port:n,protocol:t.protocol,search:t.search}}function l(e,t){return e.type===t}var E,m,g,w,y;class _{constructor(e){var t;this._sourceOrigins=[f(e).origin,(t=f(e),f(0===t.hostname.indexOf("www")?t.href:t.href.replace(t.hostname,`www.${t.hostname}`))).origin],this._isListening=!1,this._listeners={}}listen(){this._isListening||(this._isListening=!0,window.addEventListener("message",this._handleMessage))}stopListen(){this._isListening&&(this._isListening=!1,window.removeEventListener("message",this._handleMessage))}addListener(e,t){let n=this._listeners[e];n||(this._listeners[e]=n=[]),-1===n.indexOf(t)&&n.push(t)}removeListener(e,t){const n=this._listeners[e];if(!n)return;const r=n.indexOf(t);r>=0&&n.splice(r,1)}trigger(e,t){const n=this._listeners[e.type];n&&n.forEach(n=>t?n(e,t):n(e))}_handleMessage(e){if(-1===this._sourceOrigins.indexOf(e.origin)||!l(e.data,e.data.type))return;const t=e.data,{context:n}=t,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}(t,["context"]);this.trigger(r,n)}}!function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);i>3&&o&&Object.defineProperty(t,n,o)}([function(e,t,n){return t&&n?p(0,t,n):function(e){const t=class extends e{};return Object.getOwnPropertyNames(e.prototype).forEach(n=>{const r=Object.getOwnPropertyDescriptor(e.prototype,n);r&&"constructor"!==n&&Object.defineProperty(t.prototype,n,p(e.prototype,n,r))}),t}(e)}],_.prototype,"_handleMessage",null);class O{constructor(e,t,n){this._targetWindow=t,this._context=n,this._targetOrigin="*"===e?"*":f(e).origin}post(e,t){const o=this._targetWindow;if(window===o)return;if(!o)throw new Error("Unable to post message because target window is not set.");const a=t&&n(window,"message").pipe(r(e=>e.origin===this._targetOrigin&&l(e.data,e.data.type)&&-1!==[t.successType,t.errorType].indexOf(e.data.type)),s(e=>{if(t.errorType===e.data.type)throw e.data;return e.data}),i(1)).toPromise();return o.postMessage(Object.assign(Object.assign({},e),{context:this._context}),this._targetOrigin),a}setTarget(e){this._targetWindow=e}setContext(e){this._context=e}}!function(e){e.ReloadCheckout="EXTENSION:RELOAD_CHECKOUT",e.ShowLoadingIndicator="EXTENSION:SHOW_LOADING_INDICATOR",e.SetIframeStyle="EXTENSION:SET_IFRAME_STYLE",e.ReRenderShippingForm="EXTENSION:RE_RENDER_SHIPPING_FORM",e.ReRenderShippingStep="EXTENSION:RE_RENDER_SHIPPING_STEP"}(E||(E={})),function(e){e.ConsignmentsChanged="EXTENSION:CONSIGNMENTS_CHANGED"}(m||(m={})),function(e){e.Subscribe="EXTENSION_INTERNAL:SUBSCRIBE",e.Unsubscribe="EXTENSION_INTERNAL:UNSUBSCRIBE",e.ResizeIframe="EXTENSION_INTERNAL:RESIZE_IFRAME"}(g||(g={})),function(e){e.ExtensionReady="EXTENSION:READY",e.ExtensionFailed="EXTENSION:FAILED"}(w||(w={})),function(e){e.GetConsignments="EXTENSION:GET_CONSIGNMENTS"}(y||(y={}));var I=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}c((r=r.apply(e,t||[])).next())})};class N{constructor(e,t,n,r){this._messageListener=e,this._eventListener=t,this._messagePoster=n,this._internalCommandPoster=r,this._messagePoster.setTarget(window.parent),this._internalCommandPoster.setTarget(window.parent)}initialize(e){return I(this,void 0,void 0,function*(){if(!e)throw new Error("Extension Id not found.");this._extensionId=e,this._messageListener.listen(),this._eventListener.listen(),this._messagePoster.setContext({extensionId:e});try{yield this._internalCommandPoster.post({type:g.ResizeIframe,payload:{extensionId:e}},{successType:w.ExtensionReady,errorType:w.ExtensionFailed})}catch(e){if(this._isExtensionFailedEvent(e))throw new Error("Extension failed to load within 60 seconds; please reload and try again.")}})}post(e){if(!this._isCommandOrQueryType(e.type))throw new Error(`${e.type} is not supported.`);this._messagePoster.post(e)}addListener(e,t=o){if(!this._extensionId)throw new Error("Extension is not initialized.");const n=this._extensionId;if(!Object.values(m).includes(e))throw new Error(`${e} is not supported.`);return this._internalCommandPoster.post({type:g.Subscribe,payload:{extensionId:n,eventType:e}}),this._eventListener.addListener(e,t),()=>{this._internalCommandPoster.post({type:g.Unsubscribe,payload:{extensionId:n,eventType:e}}),this._eventListener.removeListener(e,t)}}getConsignments(e=!0){return I(this,void 0,void 0,function*(){return new Promise(t=>{const n=e=>{this._messageListener.removeListener("EXTENSION:GET_CONSIGNMENTS",n),t(e.payload.consignments)};this._messageListener.addListener("EXTENSION:GET_CONSIGNMENTS",n),this.post({type:y.GetConsignments,payload:{useCache:e}})})})}_isExtensionFailedEvent(e){return e.type===w.ExtensionFailed}_isCommandOrQueryType(e){return Object.values(E).includes(e)||Object.values(y).includes(e)}}function v(e){return t=this,n=void 0,s=function*(){const{extensionId:t,parentOrigin:n,taggedElementId:r,fixedHeight:s}=e;d(939);const i=new N(new _(n),new _(n),new O(n),new O(n));return yield i.initialize(t),function(e,t){if(!function(e){return"parentIFrame"in e}(window))throw new Error("iFramerResizer window not found.");if(t)window.parentIFrame.size(t);else if(window.parentIFrame.autoResize(!0),e){const t=document.getElementById(e);if(!t)throw new Error("Element not found.");t.setAttribute("data-iframe-height",""),window.parentIFrame.setHeightCalculationMethod("taggedElement")}else window.parentIFrame.setHeightCalculationMethod("bodyOffset")}(r,s),i},new((r=void 0)||(r=Promise))(function(e,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(o,a)}c((s=s.apply(t,n||[])).next())});var t,n,r,s}export{E as ExtensionCommandType,m as ExtensionEventType,v as initializeExtensionService};
//# sourceMappingURL=extension.js.map