{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://@bigcommerce/checkout-sdk/external module \"iframe-resizer\"","webpack://@bigcommerce/checkout-sdk/external module \"iframe-resizer/js/iframeResizer.contentWindow\"","webpack://@bigcommerce/checkout-sdk/webpack/bootstrap","webpack://@bigcommerce/checkout-sdk/webpack/runtime/define property getters","webpack://@bigcommerce/checkout-sdk/webpack/runtime/hasOwnProperty shorthand","webpack://@bigcommerce/checkout-sdk/./packages/utility/src/bind-decorator/bind-decorator.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/error/errors/standard-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/utility/set-prototype-of.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/error/errors/invalid-argument-error.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/url/parse-url.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/iframe/is-iframe-event.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/extension-commands.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/extension-events.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/extension-internal-commands.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/extension-internal-events.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/extension-queries.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/iframe/iframe-event-listener.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/url/append-www.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/iframe/iframe-event-poster.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/extension-service.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/initialize-extension-service.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/common/iframe/iframe-resizer.ts","webpack://@bigcommerce/checkout-sdk/./packages/core/src/extension/iframe-resizer-setup.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE_iframe_resizer_1512d797__;","module.exports = __WEBPACK_EXTERNAL_MODULE_iframe_resizer_js_iframeResizer_contentWindow_a6cfc03f__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\n * Decorates a class or a method by binding all its prototype methods or itself\n * to the calling instance respectively.\n */\nfunction bindDecorator<T extends Method>(\n    target: object,\n    key: string,\n    descriptor: TypedPropertyDescriptor<T>,\n): TypedPropertyDescriptor<T>;\nfunction bindDecorator<T extends Constructor<object>>(target: T): T;\n\nfunction bindDecorator(target: any, key?: any, descriptor?: any): any {\n    if (!key || !descriptor) {\n        return bindClassDecorator(target);\n    }\n\n    return bindMethodDecorator(target, key, descriptor);\n}\n\nexport default bindDecorator;\n\n/**\n * Decorates a class by binding all its prototype methods to the calling\n * instance.\n */\nexport function bindClassDecorator<T extends Constructor<object>>(target: T): T {\n    const decoratedTarget = class extends target {};\n\n    Object.getOwnPropertyNames(target.prototype).forEach((key) => {\n        const descriptor = Object.getOwnPropertyDescriptor(target.prototype, key);\n\n        if (!descriptor || key === 'constructor') {\n            return;\n        }\n\n        Object.defineProperty(\n            decoratedTarget.prototype,\n            key,\n            bindMethodDecorator(target.prototype, key, descriptor),\n        );\n    });\n\n    return decoratedTarget;\n}\n\n/**\n * Decorates a method by binding it to the calling instance.\n */\nexport function bindMethodDecorator<T extends Method>(\n    _: object,\n    key: string,\n    descriptor: TypedPropertyDescriptor<T>,\n): TypedPropertyDescriptor<T> {\n    if (typeof descriptor.value !== 'function') {\n        return descriptor;\n    }\n\n    let method: T = descriptor.value;\n\n    return {\n        get() {\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            const boundMethod = method.bind(this) as T;\n\n            Object.defineProperty(this, key, {\n                ...descriptor,\n                value: boundMethod,\n            });\n\n            return boundMethod;\n        },\n        set(value) {\n            method = value;\n        },\n    };\n}\n\nexport type Constructor<T> = new (...args: any[]) => T;\nexport type Method = (...args: any[]) => any;\n","import { setPrototypeOf } from '../../utility';\n\nimport CustomError from './custom-error';\n\n/**\n * This error type should not be constructed directly. It is a base class for\n * all custom errors thrown in this library.\n */\nexport default abstract class StandardError extends Error implements CustomError {\n    name = 'StandardError';\n    type = 'standard';\n\n    constructor(message?: string) {\n        super(message || 'An unexpected error has occurred.');\n\n        setPrototypeOf(this, new.target.prototype);\n\n        if (typeof Error.captureStackTrace === 'function') {\n            Error.captureStackTrace(this, new.target);\n        } else {\n            this.stack = new Error(this.message).stack;\n        }\n    }\n}\n","export default function setPrototypeOf(object: any, prototype: object) {\n    if (Object.setPrototypeOf) {\n        Object.setPrototypeOf(object, prototype);\n    } else {\n        object.__proto__ = prototype;\n    }\n\n    return object;\n}\n","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when a method is unable to proceed because the\n * caller has not provided all the arguments according to their requirements,\n * i.e.: if an argument is missing or it is not the expected data type.\n */\nexport default class InvalidArgumentError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Invalid arguments have been provided.');\n\n        this.name = 'InvalidArgumentError';\n        this.type = 'invalid_argument';\n    }\n}\n","import { InvalidArgumentError } from '../error/errors';\n\nimport Url from './url';\n\nexport default function parseUrl(url: string): Url {\n    if (!/^(https?:)?\\/\\//.test(url)) {\n        throw new InvalidArgumentError('The provided URL must be absolute.');\n    }\n\n    // new URL() is not supported in IE11, use anchor tag instead\n    const anchor = document.createElement('a');\n\n    anchor.href = url;\n\n    // IE11 returns 80 or 443 for the port number depending on the URL scheme,\n    // even if the port number is not specified in the URL.\n    const port =\n        anchor.port && url.indexOf(`${anchor.hostname}:${anchor.port}`) !== -1 ? anchor.port : '';\n\n    return {\n        hash: anchor.hash,\n        hostname: anchor.hostname,\n        href: anchor.href,\n        origin: `${anchor.protocol}//${anchor.hostname}${port ? `:${port}` : ''}`,\n        pathname: anchor.pathname,\n        port,\n        protocol: anchor.protocol,\n        search: anchor.search,\n    };\n}\n","import IframeEvent from './iframe-event';\n\nexport default function isIframeEvent<TEvent extends IframeEvent<TType>, TType extends string>(\n    object: any,\n    type: TType,\n): object is TEvent {\n    return object.type === type;\n}\n","export type ExtensionCommand =\n    | ReloadCheckoutCommand\n    | ShowLoadingIndicatorCommand\n    | SetIframeStyleCommand\n    | ReRenderShippingForm\n    | ReRenderShippingStep;\n\nexport enum ExtensionCommandType {\n    ReloadCheckout = 'EXTENSION:RELOAD_CHECKOUT',\n    ShowLoadingIndicator = 'EXTENSION:SHOW_LOADING_INDICATOR',\n    SetIframeStyle = 'EXTENSION:SET_IFRAME_STYLE',\n    ReRenderShippingForm = 'EXTENSION:RE_RENDER_SHIPPING_FORM',\n    ReRenderShippingStep = 'EXTENSION:RE_RENDER_SHIPPING_STEP',\n}\n\nexport interface ReloadCheckoutCommand {\n    type: ExtensionCommandType.ReloadCheckout;\n}\n\nexport interface ShowLoadingIndicatorCommand {\n    type: ExtensionCommandType.ShowLoadingIndicator;\n    payload: {\n        show: boolean;\n    };\n}\n\nexport interface SetIframeStyleCommand {\n    type: ExtensionCommandType.SetIframeStyle;\n    payload: {\n        style: {\n            [key: string]: string | number | null;\n        };\n    };\n}\n\nexport interface ReRenderShippingForm {\n    type: ExtensionCommandType.ReRenderShippingForm;\n}\n\nexport interface ReRenderShippingStep {\n    type: ExtensionCommandType.ReRenderShippingStep;\n}\nexport interface ExtensionCommandMap {\n    [ExtensionCommandType.ReloadCheckout]: ReloadCheckoutCommand;\n    [ExtensionCommandType.ShowLoadingIndicator]: ShowLoadingIndicatorCommand;\n    [ExtensionCommandType.SetIframeStyle]: SetIframeStyleCommand;\n    [ExtensionCommandType.ReRenderShippingForm]: ReRenderShippingForm;\n    [ExtensionCommandType.ReRenderShippingStep]: ReRenderShippingStep;\n}\n","import { Consignment } from '../shipping';\n\nexport enum ExtensionEventType {\n    ConsignmentsChanged = 'EXTENSION:CONSIGNMENTS_CHANGED',\n}\n\nexport interface ConsignmentsChangedEvent {\n    type: ExtensionEventType.ConsignmentsChanged;\n    payload: {\n        consignments: Consignment[];\n        previousConsignments: Consignment[];\n    };\n}\n\nexport type ExtensionEvent = ConsignmentsChangedEvent;\n\nexport interface ExtensionEventMap {\n    [ExtensionEventType.ConsignmentsChanged]: ConsignmentsChangedEvent;\n}\n","import { ExtensionEventType } from './extension-events';\n\nexport enum ExtensionInternalCommandType {\n    Subscribe = 'EXTENSION_INTERNAL:SUBSCRIBE',\n    Unsubscribe = 'EXTENSION_INTERNAL:UNSUBSCRIBE',\n    ResizeIframe = 'EXTENSION_INTERNAL:RESIZE_IFRAME',\n}\n\nexport interface ExtensionSubscribeCommand {\n    type: ExtensionInternalCommandType.Subscribe;\n    payload: {\n        extensionId: string;\n        eventType: ExtensionEventType;\n    };\n}\n\nexport interface ExtensionUnsubscribeCommand {\n    type: ExtensionInternalCommandType.Unsubscribe;\n    payload: {\n        extensionId: string;\n        eventType: ExtensionEventType;\n    };\n}\n\nexport interface ExtensionResizeIframeCommand {\n    type: ExtensionInternalCommandType.ResizeIframe;\n    payload: {\n        extensionId: string;\n    };\n}\n\nexport interface ExtensionInternalCommandMap {\n    [ExtensionInternalCommandType.Subscribe]: ExtensionSubscribeCommand;\n    [ExtensionInternalCommandType.Unsubscribe]: ExtensionUnsubscribeCommand;\n    [ExtensionInternalCommandType.ResizeIframe]: ExtensionResizeIframeCommand;\n}\n\nexport type ExtensionInternalCommand =\n    | ExtensionSubscribeCommand\n    | ExtensionUnsubscribeCommand\n    | ExtensionResizeIframeCommand;\n","export enum ExtensionInternalEventType {\n    ExtensionReady = 'EXTENSION:READY',\n    ExtensionFailed = 'EXTENSION:FAILED',\n}\n\nexport interface ExtensionReadyEvent {\n    type: ExtensionInternalEventType.ExtensionReady;\n}\n\nexport interface ExtensionFailedEvent {\n    type: ExtensionInternalEventType.ExtensionFailed;\n}\n\nexport type ExtensionInternalEvent = ExtensionReadyEvent | ExtensionFailedEvent;\n","export type ExtensionQuery = GetConsignmentsQuery;\n\nexport enum ExtensionQueryType {\n    GetConsignments = 'EXTENSION:GET_CONSIGNMENTS',\n}\n\nexport interface GetConsignmentsQuery {\n    type: ExtensionQueryType.GetConsignments;\n    payload?: {\n        useCache?: boolean;\n    };\n}\n\nexport interface ExtensionQueryMap {\n    [ExtensionQueryType.GetConsignments]: GetConsignmentsQuery;\n}\n","import { bindDecorator as bind } from '@bigcommerce/checkout-sdk/utility';\n\nimport { appendWww, parseUrl } from '../url';\n\nimport { IframeEventMap } from './iframe-event';\nimport isIframeEvent from './is-iframe-event';\n\nexport default class IframeEventListener<\n    TEventMap extends IframeEventMap<keyof TEventMap>,\n    TContext = undefined,\n> {\n    private _isListening: boolean;\n    private _listeners: EventListeners<TEventMap, TContext>;\n    private _sourceOrigins: string[];\n\n    constructor(sourceOrigin: string) {\n        this._sourceOrigins = [\n            parseUrl(sourceOrigin).origin,\n            appendWww(parseUrl(sourceOrigin)).origin,\n        ];\n        this._isListening = false;\n        this._listeners = {};\n    }\n\n    listen(): void {\n        if (this._isListening) {\n            return;\n        }\n\n        this._isListening = true;\n\n        window.addEventListener('message', this._handleMessage);\n    }\n\n    stopListen(): void {\n        if (!this._isListening) {\n            return;\n        }\n\n        this._isListening = false;\n\n        window.removeEventListener('message', this._handleMessage);\n    }\n\n    addListener<TType extends keyof TEventMap>(\n        type: TType,\n        listener: (event: TEventMap[TType], context?: TContext) => void,\n    ): void {\n        let listeners = this._listeners[type];\n\n        if (!listeners) {\n            this._listeners[type] = listeners = [];\n        }\n\n        if (listeners.indexOf(listener) === -1) {\n            listeners.push(listener);\n        }\n    }\n\n    removeListener<TType extends keyof TEventMap>(\n        type: TType,\n        listener: (event: TEventMap[TType], context?: TContext) => void,\n    ): void {\n        const listeners = this._listeners[type];\n\n        if (!listeners) {\n            return;\n        }\n\n        const index = listeners.indexOf(listener);\n\n        if (index >= 0) {\n            listeners.splice(index, 1);\n        }\n    }\n\n    trigger<TType extends keyof TEventMap>(event: TEventMap[TType], context?: TContext): void {\n        const listeners = this._listeners[event.type];\n\n        if (!listeners) {\n            return;\n        }\n\n        listeners.forEach((listener) => (context ? listener(event, context) : listener(event)));\n    }\n\n    @bind\n    private _handleMessage(messageEvent: MessageEvent): void {\n        if (\n            this._sourceOrigins.indexOf(messageEvent.origin) === -1 ||\n            !isIframeEvent(messageEvent.data as TEventMap[keyof TEventMap], messageEvent.data.type)\n        ) {\n            return;\n        }\n\n        const { context, ...event } = messageEvent.data;\n\n        this.trigger(event, context);\n    }\n}\n\nexport type EventListeners<TEventMap, TContext = undefined> = {\n    [key in keyof TEventMap]?: Array<(event: TEventMap[key], context?: TContext) => void>;\n};\n","import parseUrl from './parse-url';\nimport Url from './url';\n\nexport default function appendWww(url: Url): Url {\n    return parseUrl(\n        url.hostname.indexOf('www') === 0\n            ? url.href\n            : url.href.replace(url.hostname, `www.${url.hostname}`),\n    );\n}\n","import { fromEvent } from 'rxjs';\nimport { filter, map, take } from 'rxjs/operators';\n\nimport { parseUrl } from '../url';\n\nimport IframeEvent from './iframe-event';\nimport isIframeEvent from './is-iframe-event';\n\nexport interface IframeEventPostOptions<\n    TSuccessEvent extends IframeEvent,\n    TErrorEvent extends IframeEvent,\n> {\n    errorType?: TErrorEvent['type'];\n    successType?: TSuccessEvent['type'];\n}\n\nexport default class IframeEventPoster<TEvent, TContext = undefined> {\n    private _targetOrigin: string;\n\n    constructor(targetOrigin: string, private _targetWindow?: Window, private _context?: TContext) {\n        this._targetOrigin = targetOrigin === '*' ? '*' : parseUrl(targetOrigin).origin;\n    }\n\n    post(event: TEvent): void;\n    post<\n        TSuccessEvent extends IframeEvent = IframeEvent,\n        TErrorEvent extends IframeEvent = IframeEvent,\n    >(\n        event: TEvent,\n        options: IframeEventPostOptions<TSuccessEvent, TErrorEvent>,\n    ): Promise<TSuccessEvent>;\n    post<\n        TSuccessEvent extends IframeEvent = IframeEvent,\n        TErrorEvent extends IframeEvent = IframeEvent,\n    >(\n        event: TEvent,\n        options?: IframeEventPostOptions<TSuccessEvent, TErrorEvent>,\n    ): Promise<TSuccessEvent> | void {\n        const targetWindow = this._targetWindow;\n\n        if (window === targetWindow) {\n            return;\n        }\n\n        if (!targetWindow) {\n            throw new Error('Unable to post message because target window is not set.');\n        }\n\n        const result =\n            options &&\n            fromEvent<MessageEvent>(window, 'message')\n                .pipe(\n                    filter(\n                        (event) =>\n                            event.origin === this._targetOrigin &&\n                            isIframeEvent(event.data, event.data.type) &&\n                            [options.successType, options.errorType].indexOf(event.data.type) !==\n                                -1,\n                    ),\n                    map((event) => {\n                        if (options.errorType === event.data.type) {\n                            throw event.data;\n                        }\n\n                        return event.data;\n                    }),\n                    take(1),\n                )\n                .toPromise();\n\n        targetWindow.postMessage({ ...event, context: this._context }, this._targetOrigin);\n\n        return result;\n    }\n\n    setTarget(window: Window) {\n        this._targetWindow = window;\n    }\n\n    setContext(context: TContext) {\n        this._context = context;\n    }\n}\n","import { noop } from 'lodash';\n\nimport { Consignment } from '@bigcommerce/checkout-sdk/payment-integration-api';\n\nimport { IframeEventListener, IframeEventPoster } from '../common/iframe';\n\nimport { ExtensionCommandType } from './extension-commands';\nimport { ExtensionEventMap, ExtensionEventType } from './extension-events';\nimport {\n    ExtensionInternalCommand,\n    ExtensionInternalCommandType,\n} from './extension-internal-commands';\nimport { ExtensionInternalEventType } from './extension-internal-events';\nimport {\n    ExtensionCommandOrQuery,\n    ExtensionCommandOrQueryContext,\n    ExtensionMessageMap,\n    ExtensionMessageType,\n    GetConsignmentsMessage,\n} from './extension-message';\nimport { ExtensionQueryType } from './extension-queries';\n\nexport default class ExtensionService {\n    private _extensionId?: string;\n\n    constructor(\n        private _messageListener: IframeEventListener<ExtensionMessageMap>,\n        private _eventListener: IframeEventListener<ExtensionEventMap>,\n        private _messagePoster: IframeEventPoster<\n            ExtensionCommandOrQuery,\n            ExtensionCommandOrQueryContext\n        >,\n        private _internalCommandPoster: IframeEventPoster<ExtensionInternalCommand>,\n    ) {\n        this._messagePoster.setTarget(window.parent);\n        this._internalCommandPoster.setTarget(window.parent);\n    }\n\n    async initialize(extensionId: string): Promise<void> {\n        if (!extensionId) {\n            throw new Error('Extension Id not found.');\n        }\n\n        this._extensionId = extensionId;\n\n        this._messageListener.listen();\n        this._eventListener.listen();\n        this._messagePoster.setContext({ extensionId });\n\n        try {\n            await this._internalCommandPoster.post(\n                {\n                    type: ExtensionInternalCommandType.ResizeIframe,\n                    payload: { extensionId },\n                },\n                {\n                    successType: ExtensionInternalEventType.ExtensionReady,\n                    errorType: ExtensionInternalEventType.ExtensionFailed,\n                },\n            );\n        } catch (event) {\n            if (this._isExtensionFailedEvent(event)) {\n                throw new Error(\n                    'Extension failed to load within 60 seconds; please reload and try again.',\n                );\n            }\n        }\n    }\n\n    post(command: ExtensionCommandOrQuery): void {\n        if (!this._isCommandOrQueryType(command.type)) {\n            throw new Error(`${command.type} is not supported.`);\n        }\n\n        this._messagePoster.post(command);\n    }\n\n    addListener(eventType: ExtensionEventType, callback: () => void = noop): () => void {\n        if (!this._extensionId) {\n            throw new Error('Extension is not initialized.');\n        }\n\n        const extensionId = this._extensionId;\n\n        if (!Object.values(ExtensionEventType).includes(eventType)) {\n            throw new Error(`${eventType} is not supported.`);\n        }\n\n        this._internalCommandPoster.post({\n            type: ExtensionInternalCommandType.Subscribe,\n            payload: { extensionId, eventType },\n        });\n\n        this._eventListener.addListener(eventType, callback);\n\n        return () => {\n            this._internalCommandPoster.post({\n                type: ExtensionInternalCommandType.Unsubscribe,\n                payload: { extensionId, eventType },\n            });\n\n            this._eventListener.removeListener(eventType, callback);\n        };\n    }\n\n    async getConsignments(useCache = true): Promise<Consignment[]> {\n        return new Promise((resolve) => {\n            const callback = (event: GetConsignmentsMessage) => {\n                this._messageListener.removeListener(\n                    ExtensionMessageType.GetConsignments,\n                    callback,\n                );\n\n                resolve(event.payload.consignments);\n            };\n\n            this._messageListener.addListener(ExtensionMessageType.GetConsignments, callback);\n\n            this.post({ type: ExtensionQueryType.GetConsignments, payload: { useCache } });\n        });\n    }\n\n    private _isExtensionFailedEvent(\n        event: any,\n    ): event is ExtensionInternalEventType.ExtensionFailed {\n        return event.type === ExtensionInternalEventType.ExtensionFailed;\n    }\n\n    private _isCommandOrQueryType(type: any): type is ExtensionCommandOrQuery['type'] {\n        return (\n            Object.values(ExtensionCommandType).includes(type) ||\n            Object.values(ExtensionQueryType).includes(type)\n        );\n    }\n}\n","import {\n    IframeEventListener,\n    IframeEventPoster,\n    setupContentWindowForIframeResizer,\n} from '../common/iframe';\n\nimport { ExtensionCommand } from './extension-commands';\nimport { ExtensionEventMap } from './extension-events';\nimport { ExtensionInternalCommand } from './extension-internal-commands';\nimport { ExtensionCommandOrQueryContext, ExtensionMessageMap } from './extension-message';\nimport ExtensionService from './extension-service';\nimport { iframeResizerSetup } from './iframe-resizer-setup';\n\nexport interface InitializeExtensionServiceOptions {\n    extensionId: string;\n    parentOrigin: string;\n    taggedElementId?: string;\n    fixedHeight?: number;\n}\n\nexport default async function initializeExtensionService(\n    options: InitializeExtensionServiceOptions,\n): Promise<ExtensionService> {\n    const { extensionId, parentOrigin, taggedElementId, fixedHeight } = options;\n\n    setupContentWindowForIframeResizer();\n\n    const extension = new ExtensionService(\n        new IframeEventListener<ExtensionMessageMap>(parentOrigin),\n        new IframeEventListener<ExtensionEventMap>(parentOrigin),\n        new IframeEventPoster<ExtensionCommand, ExtensionCommandOrQueryContext>(parentOrigin),\n        new IframeEventPoster<ExtensionInternalCommand>(parentOrigin),\n    );\n\n    await extension.initialize(extensionId);\n\n    iframeResizerSetup(taggedElementId, fixedHeight);\n\n    return extension;\n}\n","import { IFrameComponent, IFrameOptions } from 'iframe-resizer';\n\nexport {\n    HeightCalculationMethod,\n    IFrameComponent,\n    IFrameMessageData,\n    IFrameObject,\n    IFrameOptions,\n    IFramePage,\n    IFramePageOptions,\n    IFrameResizedData,\n    IFrameScrollData,\n    PageInfo,\n    WidthCalculationMethod,\n} from 'iframe-resizer';\n\n// The reason why we are wrapping the original `iframeResizer` function imported\n// from the package is because the package sets up event listeners (window\n// resize etc...) as soon as the package is imported. Therefore, to defer the\n// side effect from happening until the function is actually being used, we are\n// importing the package inside this function. To minimise the chance of\n// importing the original package inadvertently, we are also re-exporting all of\n// its public interfaces. The re-exports do not cause any side effect because\n// they are plain TypeScript interfaces; meaning they are only used for type\n// checks rather than for code output.\nexport function iframeResizer(\n    options: IFrameOptions,\n    target: string | HTMLElement,\n): IFrameComponent[] {\n    /* eslint-disable @typescript-eslint/no-var-requires */\n    const { iframeResizer: originalIframeResizer } = require('iframe-resizer');\n\n    return originalIframeResizer(options, target);\n}\n\n// We also need to wrap the original `iframeResizer.contentWindow` because\n// similarly the package sets up event listeners as soon as the package gets\n// imported. Another reason is that if it is imported at the top level using a\n// regular import statement, it will be stripped out by Webpack as it is\n// considered as \"unused\", unless we explicitly mark it as a package that\n// produces side effects.\nexport function setupContentWindowForIframeResizer(): void {\n    require('iframe-resizer/js/iframeResizer.contentWindow');\n}\n","export interface IframeResizerWindow extends Window {\n    parentIFrame: {\n        autoResize: (isEnabled: boolean) => void;\n        setHeightCalculationMethod: (id: string) => void;\n        size: (height: number) => void;\n    };\n}\n\nexport function isIframeResizerWindow(window: Window): window is IframeResizerWindow {\n    return 'parentIFrame' in window;\n}\n\nexport function iframeResizerSetup(\n    taggedElementId: string | undefined,\n    fixedHeight: number | undefined,\n): void {\n    if (!isIframeResizerWindow(window)) {\n        throw new Error('iFramerResizer window not found.');\n    }\n\n    if (fixedHeight) {\n        window.parentIFrame.size(fixedHeight);\n    } else {\n        window.parentIFrame.autoResize(true);\n\n        if (taggedElementId) {\n            const element = document.getElementById(taggedElementId);\n\n            if (!element) {\n                throw new Error(`Element not found.`);\n            }\n\n            element.setAttribute('data-iframe-height', '');\n            window.parentIFrame.setHeightCalculationMethod('taggedElement');\n        } else {\n            window.parentIFrame.setHeightCalculationMethod('bodyOffset');\n        }\n    }\n}\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE_iframe_resizer_1512d797__","__WEBPACK_EXTERNAL_MODULE_iframe_resizer_js_iframeResizer_contentWindow_a6cfc03f__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","bindMethodDecorator","_","descriptor","value","method","boundMethod","bind","this","set","StandardError","Error","constructor","message","super","name","type","setPrototypeOf","__proto__","captureStackTrace","stack","InvalidArgumentError","parseUrl","url","test","anchor","document","createElement","href","port","indexOf","hostname","hash","origin","protocol","pathname","search","isIframeEvent","object","ExtensionCommandType","ExtensionEventType","ExtensionInternalCommandType","ExtensionInternalEventType","ExtensionQueryType","IframeEventListener","sourceOrigin","_sourceOrigins","replace","_isListening","_listeners","listen","window","addEventListener","_handleMessage","stopListen","removeEventListener","addListener","listener","listeners","push","removeListener","index","splice","trigger","event","context","forEach","messageEvent","data","target","decoratedTarget","getOwnPropertyNames","getOwnPropertyDescriptor","bindClassDecorator","IframeEventPoster","targetOrigin","_targetWindow","_context","_targetOrigin","post","options","targetWindow","result","fromEvent","pipe","filter","successType","errorType","map","take","toPromise","postMessage","setTarget","setContext","ExtensionService","_messageListener","_eventListener","_messagePoster","_internalCommandPoster","parent","initialize","extensionId","_extensionId","ResizeIframe","payload","ExtensionReady","ExtensionFailed","_isExtensionFailedEvent","command","_isCommandOrQueryType","eventType","callback","noop","values","includes","Subscribe","Unsubscribe","getConsignments","useCache","Promise","resolve","consignments","GetConsignments","initializeExtensionService","parentOrigin","taggedElementId","fixedHeight","extension","isIframeResizerWindow","parentIFrame","size","autoResize","element","getElementById","setAttribute","setHeightCalculationMethod","iframeResizerSetup"],"sourceRoot":""}